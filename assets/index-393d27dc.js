(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const s=document.getElementById("my_table"),_=document.getElementById("add_row_form"),g=document.getElementById("columns_input"),k=document.getElementById("reset_button"),h=document.getElementById("edit_dialog"),f=document.getElementById("edit_form"),l=document.getElementById("search_work_input"),w=document.getElementById("search_result"),I=document.getElementById("img_file_input"),p=document.getElementById("img_container"),c=document.getElementById("img_preview"),v=document.getElementById("description"),B=document.getElementById("cancel"),m=document.getElementById("save_button");let d,u;function b({numColumns:t,descriptionList:e}){e?t=e.length:t||(t=s.rows[0].cells.length);function i(n,r){return parseInt(Math.random()*(r-n)+n)}const a=s.insertRow(-1);for(let n=0;n<t;n++){const r=a.insertCell(n);r.innerHTML='<div class="cell-wrapper"><img class="cell-img" src="data:," alt="data:," /><div class="cell-description"></div></div>',d=r.querySelector(".cell-img"),u=r.querySelector(".cell-description"),e?y("https://picsum.photos/"+i(250,300)+"/"+i(400,450),e[n]):y("https://picsum.photos/"+i(250,300)+"/"+i(400,450),"點擊選擇")}}function y(t,e){t!=="data:,"&&(d.src=t,d.alt=t),u.innerText=e}f.addEventListener("submit",function(t){t.preventDefault(),y(c.src,v.value),c.src="data:,",c.style.display="none",h.style.display="none",f.reset()});B.addEventListener("click",function(){h.style.display="none"});function L(t){const e=new FileReader;e.addEventListener("load",function(){c.src=e.result,c.style.display="block"}),e.readAsDataURL(t)}I.addEventListener("change",function(){const t=I.files[0];L(t)});f.addEventListener("paste",function(t){const e=t.clipboardData||window.clipboardData;if(!e)return;const i=[...e.items].find(a=>a.type.includes("image"));(i==null?void 0:i.kind)==="file"&&L(i.getAsFile())});s.addEventListener("click",function(t){h.style.display="block";const e=t.target.closest(".cell-wrapper");d=e.querySelector(".cell-img"),u=e.querySelector(".cell-description"),v.value=u.innerText,l.focus()});k.addEventListener("click",function(){g.disabled=!1,s.innerHTML=""});_.addEventListener("submit",function(t){t.preventDefault(),g.disabled=!0,b({numColumns:g.value})});m.addEventListener("click",async function(){m.innerText="載入中...";const t=document.getElementById("table_container_wrapper");try{const e=await html2canvas(t,{useCORS:!0}),i=document.createElement("a");i.download="image.png",i.href=e.toDataURL(),i.click()}catch(e){console.error(e)}m.innerText="儲存"});function P(t){for(const e of t)b({descriptionList:e})}function q(t,e=300){let i;return(...a)=>{clearTimeout(i),i=setTimeout(()=>{t.apply(this,a)},e)}}async function O(t){if(t.key==="Enter"&&t.preventDefault(),l.value==="")return;let e=l.value;e.length>=3&&(e=await S(e)??e),w.innerText="搜尋中...";const i=await D(e);p.innerHTML="";for(const a of i){const n=document.createElement("img");n.src=a,n.addEventListener("click",function(){c.src=n.src,c.style.display="block",p.innerHTML=""}),p.appendChild(n)}w.innerHTML=`<span>找不到想要的圖片嗎？</span><a href="https://www.google.com/search?tbm=isch&q=${e}" target="_blank">在Google圖片搜尋</a><div>(右鍵複製圖片後在此貼上)</div>`}l.addEventListener("keydown",q(O));async function S(t){t=encodeURIComponent(t);let e=`https://zh.wikipedia.org/w/api.php?action=opensearch&search=${t}&limit=10&namespace=0&redirects=resolve&format=json&origin=*`;try{let i=await fetch(e),a=await i.json();if(!a[1][0]||(t=a[1][0],e=`https://zh.wikipedia.org/w/api.php?action=query&lllimit=1&prop=langlinks&lllang=ja&titles=${t}&format=json&origin=*`,i=await fetch(e),a=await i.json(),Object.values(a.query.pages).length===0))return;const n=Object.values(a.query.pages)[0].langlinks;return n?n[0]["*"].replace(/\s\(.*\)/,""):void 0}catch(i){console.error(i)}}async function D(t){var o,E;const n=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip"},body:JSON.stringify({query:`
  query ($page: Int, $perPage: Int, $search: String) {
    Page(page: $page, perPage: $perPage) {
      pageInfo {
        total
        currentPage
        lastPage
        hasNextPage
        perPage
      }
      media(search: $search, sort: FAVOURITES_DESC) {
        title {
          romaji
          english
          native
        }
        coverImage {
          large
        }
      }
    }
  }
  `,variables:{page:1,perPage:12,search:t}})})).json(),r=(E=(o=n==null?void 0:n.data)==null?void 0:o.Page)==null?void 0:E.media;return Array.isArray(r)&&r.length>0?r.map(T=>T.coverImage.large):[]}const F=[["入坑作","最喜歡","看最多次","最想安利","最佳劇情"],["最佳畫面","最佳配樂","最佳配音","最治癒","最感動"],["最虐心","最被低估","最過譽","最離譜","最討厭"]],j=["入坑作","最喜歡","看最多次","最想安利","最佳劇情","最佳畫面","最佳配樂","最佳配音","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭","最暴死","最佳原創","最佳漫改","最荒謬","最後悔看","最冷門神作","最佳OP","最佳ED"];function A(t){t.forEach(e=>{const i=document.createElement("option");i.text=e,i.value=e,v.add(i)})}A(j);P(F);
