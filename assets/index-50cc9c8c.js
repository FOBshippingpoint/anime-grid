(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const l=document.getElementById("my_table"),_=document.getElementById("add_row_form"),f=document.getElementById("columns_input"),B=document.getElementById("reset_button"),h=document.getElementById("edit_form"),m=document.getElementById("search_work_input"),w=document.getElementById("search_result"),I=document.getElementById("img_file_input"),c=document.getElementById("img_container"),o=document.getElementById("img_preview"),v=document.getElementById("description"),k=document.getElementById("cancel"),p=document.querySelector("dialog"),g=document.getElementById("save_button");let d,u;function P({numColumns:t,descriptionList:e}){e?t=e.length:t||(t=l.rows[0].cells.length);function r(n,a){return parseInt(Math.random()*(a-n)+n)}const s=l.insertRow(-1);for(let n=0;n<t;n++){const a=s.insertCell(n);a.innerHTML='<div class="cell-wrapper"><img class="cell-img" src="data:," alt="data:," /><div class="cell-description"></div></div>',d=a.querySelector(".cell-img"),u=a.querySelector(".cell-description"),e?y("https://picsum.photos/"+r(250,300)+"/"+r(400,450),e[n]):y("https://picsum.photos/"+r(250,300)+"/"+r(400,450),"點擊選擇")}}function y(t,e){t!=="data:,"&&(d.src=t,d.alt=t),u.innerText=e}p.addEventListener("close",()=>{c.innerHTML=""});h.addEventListener("submit",function(t){t.preventDefault(),y(o.src,v.value),o.src="data:,",o.style.display="none",p.close(),h.reset()});k.addEventListener("click",function(){p.close()});function b(t){const e=new FileReader;e.addEventListener("load",function(){o.src=e.result,o.style.display="block"}),e.readAsDataURL(t)}I.addEventListener("change",function(){const t=I.files[0];b(t)});h.addEventListener("paste",function(t){const e=t.clipboardData||window.clipboardData;if(!e)return;const r=[...e.items].find(s=>s.type.includes("image"));(r==null?void 0:r.kind)==="file"&&b(r.getAsFile())});l.addEventListener("click",function(t){p.showModal();const e=t.target.closest(".cell-wrapper");d=e.querySelector(".cell-img"),u=e.querySelector(".cell-description"),v.value=u.innerText,m.focus(),L()});B.addEventListener("click",function(){f.disabled=!1,l.innerHTML=""});_.addEventListener("submit",function(t){t.preventDefault(),f.disabled=!0,P({numColumns:f.value})});g.addEventListener("click",async function(){g.innerText="載入中...";const t=document.getElementById("table_container_wrapper");try{const e=await html2canvas(t,{useCORS:!0}),r=document.createElement("img");document.getElementById("table_container_wrapper").appendChild(r),r.src=e.toDataURL()}catch(e){console.error(e)}g.innerText="儲存"});function q(t){for(const e of t)P({descriptionList:e})}function O(t,e=300){let r;return(...s)=>{clearTimeout(r),r=setTimeout(()=>{t.apply(this,s)},e)}}async function S(t){t.key==="Enter"&&t.preventDefault(),L()}const R="http://proxy.sdovan1.com/api/imageproxy/";async function L(){let t=m.value;if(t==="")return;t=await F(t)??t,w.innerHTML="<div>搜尋中...</div><div>&nbsp</div>";const r=await j(t);c.innerHTML="";for(const s of r){const n=document.createElement("img");n.src=s,n.addEventListener("click",function(){o.src=R+n.src.replace("https","http"),o.style.display="block",c.innerHTML=""}),c.appendChild(n)}w.innerHTML=`<span>找不到想要的圖片嗎？</span><a href="https://www.google.com/search?tbm=isch&q=${t}" target="_blank">在Google圖片搜尋</a><div>(右鍵複製圖片後在此貼上)</div>`}m.addEventListener("keydown",O(S));m.addEventListener("input",()=>console.log("hi"));async function F(t){t=encodeURIComponent(t);let e=new URL("https://zh.wikipedia.org/w/api.php");e.searchParams.set("action","opensearch"),e.searchParams.set("limit","10"),e.searchParams.set("namespace","0"),e.searchParams.set("redirects","resolve"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("search",t);try{let r=await fetch(e),s=await r.json();if(!s[1][0]||(t=s[1][0],e=new URL("https://zh.wikipedia.org/w/api.php"),e.searchParams.set("action","query"),e.searchParams.set("lllimit","1"),e.searchParams.set("prop","langlinks"),e.searchParams.set("lllang","ja"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("titles",t),r=await fetch(e),s=await r.json(),Object.values(s.query.pages).length===0))return;const n=Object.values(s.query.pages)[0].langlinks;return n?n[0]["*"].replace(/\s\(.*\)/,""):void 0}catch(r){console.error(r)}}async function j(t){var i,E;const n=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip"},body:JSON.stringify({query:`
  query ($page: Int, $perPage: Int, $search: String) {
    Page(page: $page, perPage: $perPage) {
      pageInfo {
        total
        currentPage
        lastPage
        hasNextPage
        perPage
      }
      media(search: $search, sort: FAVOURITES_DESC) {
        title {
          romaji
          english
          native
        }
        coverImage {
          large
        }
      }
    }
  }
  `,variables:{page:1,perPage:12,search:t}})})).json(),a=(E=(i=n==null?void 0:n.data)==null?void 0:i.Page)==null?void 0:E.media;return Array.isArray(a)&&a.length>0?a.map(T=>T.coverImage.large):[]}const D=[["入坑作","最喜歡","看最多次","最想安利","最佳劇情"],["最佳畫面","最佳配樂","最佳配音","最治癒","最感動"],["最虐心","最被低估","最過譽","最離譜","最討厭"],["最暴死","最佳原創","最佳漫改","最荒謬","最後悔看"]],M=["入坑作","最喜歡","看最多次","最想安利","最佳劇情","最佳畫面","最佳配樂","最佳配音","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭","最暴死","最佳原創","最佳漫改","最佳輕改","最佳劇場版","最荒謬","最後悔看","最冷門神作","最佳OP","最佳ED","最期待續作","最意猶未盡"];function A(t){t.forEach(e=>{const r=document.createElement("option");r.text=e,r.value=e,v.add(r)})}A(M);q(D);
