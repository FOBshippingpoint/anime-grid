(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();const s=document.getElementById("my_table"),T=document.getElementById("add_row_form"),m=document.getElementById("columns_input"),k=document.getElementById("reset_button"),y=document.getElementById("edit_dialog"),g=document.getElementById("edit_form"),h=document.getElementById("search_work_input"),w=document.getElementById("img_file_input"),u=document.getElementById("img_container"),c=document.getElementById("img_preview"),v=document.getElementById("description"),_=document.getElementById("cancel"),p=document.getElementById("save_button");let l,d;function I({numColumns:t,descriptionList:e}){e?t=e.length:t||(t=s.rows[0].cells.length);function i(n,r){return parseInt(Math.random()*(r-n)+n)}const o=s.insertRow(-1);for(let n=0;n<t;n++){const r=o.insertCell(n);r.innerHTML='<div class="cell-wrapper"><img class="cell-img" src="data:," alt="data:," /><div class="cell-description"></div></div>',l=r.querySelector(".cell-img"),d=r.querySelector(".cell-description"),e?f("https://picsum.photos/"+i(250,300)+"/"+i(400,450),e[n]):f("https://picsum.photos/"+i(250,300)+"/"+i(400,450),"點擊選擇")}}function f(t,e){t!=="data:,"&&(l.src=t,l.alt=t),d.innerText=e}g.addEventListener("submit",function(t){t.preventDefault(),f(c.src,v.value),c.src="data:,",c.style.display="none",y.style.display="none",g.reset()});_.addEventListener("click",function(){y.style.display="none"});function b(t){const e=new FileReader;e.addEventListener("load",function(){c.src=e.result,c.style.display="block"}),e.readAsDataURL(t)}w.addEventListener("change",function(){const t=w.files[0];b(t)});g.addEventListener("paste",function(t){const e=t.clipboardData||window.clipboardData;if(!e)return;const i=[...e.items].find(o=>o.type.includes("image"));(i==null?void 0:i.kind)==="file"&&b(i.getAsFile())});s.addEventListener("click",function(t){y.style.display="block";const e=t.target.closest(".cell-wrapper");l=e.querySelector(".cell-img"),d=e.querySelector(".cell-description"),v.value=d.innerText,h.focus()});k.addEventListener("click",function(){m.disabled=!1,s.innerHTML=""});T.addEventListener("submit",function(t){t.preventDefault(),m.disabled=!0,I({numColumns:m.value})});p.addEventListener("click",async function(){p.innerText="載入中...";const t=document.getElementById("table_container_wrapper");try{const e=await html2canvas(t,{allowTaint:!0,useCORS:!0}),i=document.createElement("a");i.download="image.png",i.href=e.toDataURL(),i.click()}catch(e){console.error(e)}p.innerText="儲存"});function B(t){for(const e of t)I({descriptionList:e})}function P(t,e=300){let i;return(...o)=>{clearTimeout(i),i=setTimeout(()=>{t.apply(this,o)},e)}}async function q(t){t.key==="Enter"&&t.preventDefault();let e=h.value;e.length>=3&&(e=await O(e)??e);const i=await S(e);u.innerHTML="";for(const o of i){const n=document.createElement("img");n.src=o,n.addEventListener("click",function(){c.src=n.src,c.style.display="block",u.innerHTML=""}),u.appendChild(n)}}h.addEventListener("keydown",P(q));async function O(t){t=encodeURIComponent(t);let e=`https://zh.wikipedia.org/w/api.php?action=opensearch&search=${t}&limit=10&namespace=0&redirects=resolve&format=json&origin=*`;try{let i=await fetch(e),o=await i.json();if(!o[1][0]||(t=o[1][0],e=`https://zh.wikipedia.org/w/api.php?action=query&lllimit=1&prop=langlinks&lllang=ja&titles=${t}&format=json&origin=*`,i=await fetch(e),o=await i.json(),Object.values(o.query.pages).length===0))return;const n=Object.values(o.query.pages)[0].langlinks;return n?n[0]["*"].replace(/\s\(.*\)/,""):void 0}catch(i){console.error(i)}}async function S(t){var a,E;const n=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip"},body:JSON.stringify({query:`
  query ($page: Int, $perPage: Int, $search: String) {
    Page(page: $page, perPage: $perPage) {
      pageInfo {
        total
        currentPage
        lastPage
        hasNextPage
        perPage
      }
      media(search: $search, sort: FAVOURITES_DESC) {
        title {
          romaji
          english
          native
        }
        coverImage {
          large
        }
      }
    }
  }
  `,variables:{page:1,perPage:12,search:t}})})).json(),r=(E=(a=n==null?void 0:n.data)==null?void 0:a.Page)==null?void 0:E.media;return Array.isArray(r)&&r.length>0?r.map(L=>L.coverImage.large):[]}const F=[["入坑作","最喜歡","看最多次","最想安利","最佳劇情"],["最佳畫面","最佳配樂","最佳配音","最治癒","最感動"],["最虐心","最被低估","最過譽","最離譜","最討厭"]],j=["入坑作","最喜歡","看最多次","最想安利","最佳劇情","最佳畫面","最佳配樂","最佳配音","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭"];function D(t){t.forEach(e=>{const i=document.createElement("option");i.text=e,i.value=e,v.add(i)})}D(j);B(F);
