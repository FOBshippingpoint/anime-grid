(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const B="/anime-grid/assets/placeholder-76c5564b.webp",l=document.getElementById("my_table"),q=document.getElementById("add_row_form"),f=document.getElementById("columns_input"),O=document.getElementById("reset_button"),h=document.getElementById("edit_form"),m=document.getElementById("search_work_input"),w=document.getElementById("search_result"),E=document.getElementById("img_file_input"),o=document.getElementById("img_container"),c=document.getElementById("img_preview"),y=document.getElementById("description"),S=document.getElementById("cancel"),p=document.querySelector("dialog"),g=document.getElementById("save_button");let d,u;function P({numColumns:t,descriptionList:e}){e?t=e.length:t||(t=l.rows[0].cells.length);const r=l.insertRow(-1);for(let a=0;a<t;a++){const n=r.insertCell(a);n.innerHTML='<div class="cell-wrapper"><img class="cell-img" src="data:," alt="data:," /><div class="cell-description"></div></div>',d=n.querySelector(".cell-img"),u=n.querySelector(".cell-description");let s;e?s=e[a]:s="點擊選擇",I(B,s)}}function I(t,e){d.src=t,d.alt=t,u.innerText=e}p.addEventListener("close",()=>{o.innerHTML=""});h.addEventListener("submit",function(t){t.preventDefault(),I(c.src,y.value),c.src="data:,",c.style.display="none",p.close(),h.reset()});S.addEventListener("click",function(){p.close()});function L(t){const e=new FileReader;e.addEventListener("load",function(){c.src=e.result,c.style.display="block"}),e.readAsDataURL(t)}E.addEventListener("change",function(){const t=E.files[0];L(t)});h.addEventListener("paste",function(t){const e=t.clipboardData||window.clipboardData;if(!e)return;const r=[...e.items].find(a=>a.type.includes("image"));(r==null?void 0:r.kind)==="file"&&L(r.getAsFile())});l.addEventListener("click",function(t){p.showModal();const e=t.target.closest(".cell-wrapper");d=e.querySelector(".cell-img"),u=e.querySelector(".cell-description"),y.value=u.innerText,m.focus(),k()});O.addEventListener("click",function(){f.disabled=!1,l.innerHTML=""});q.addEventListener("submit",function(t){t.preventDefault(),f.disabled=!0,P({numColumns:f.value})});g.addEventListener("click",async function(){g.innerText="載入中...";const t=document.getElementById("table_container_wrapper");try{const e=await html2canvas(t,{useCORS:!0}),r=document.createElement("a");r.download="anime-grid.png",r.href=e.toDataURL(),r.click()}catch(e){console.error(e)}g.innerText="儲存"});function R(t){for(const e of t)P({descriptionList:e})}function b(t,e=300){let r;return(...a)=>{clearTimeout(r),r=setTimeout(()=>{t.apply(this,a)},e)}}async function T(t){t.key==="Enter"&&t.preventDefault(),k()}const F="https://imageproxy-rvvouazbtq-de.a.run.app/";async function k(){let t=m.value;if(t==="")return;t=await j(t)??t,w.innerHTML="<div>搜尋中...</div><div>&nbsp</div>";const r=await D(t);o.innerHTML="";for(const a of r){const n=document.createElement("img");n.src=a,n.addEventListener("click",function(){c.src=F+n.src.replace("https","http"),c.style.display="block",o.innerHTML=""}),o.appendChild(n)}w.innerHTML=`<span>找不到想要的圖片嗎？</span><a href="https://www.google.com/search?tbm=isch&q=${t}" target="_blank">在Google圖片搜尋</a><div>(右鍵複製圖片後在此貼上)</div>`}m.addEventListener("keydown",b(T));m.addEventListener("input",b(T));async function j(t){let e=new URL("https://zh.wikipedia.org/w/api.php");e.searchParams.set("action","opensearch"),e.searchParams.set("limit","10"),e.searchParams.set("namespace","0"),e.searchParams.set("redirects","resolve"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("search",t);try{let r=await fetch(e),a=await r.json();if(!a[1][0]||(t=a[1][0],e=new URL("https://zh.wikipedia.org/w/api.php"),e.searchParams.set("action","query"),e.searchParams.set("lllimit","1"),e.searchParams.set("prop","langlinks"),e.searchParams.set("lllang","ja"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("titles",t),r=await fetch(e),a=await r.json(),Object.values(a.query.pages).length===0))return;const n=Object.values(a.query.pages)[0].langlinks;return n?n[0]["*"].replace(/\s\(.*\)/,""):void 0}catch(r){console.error(r)}}async function D(t){var i,v;const n=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip"},body:JSON.stringify({query:`
  query ($page: Int, $perPage: Int, $search: String) {
    Page(page: $page, perPage: $perPage) {
      pageInfo {
        total
        currentPage
        lastPage
        hasNextPage
        perPage
      }
      media(search: $search, sort: FAVOURITES_DESC) {
        title {
          romaji
          english
          native
        }
        coverImage {
          large
        }
      }
    }
  }
  `,variables:{page:1,perPage:12,search:t}})})).json(),s=(v=(i=n==null?void 0:n.data)==null?void 0:i.Page)==null?void 0:v.media;return Array.isArray(s)&&s.length>0?s.map(_=>_.coverImage.large):[]}const M=[["入坑作","最喜歡","看最多次","最想安利","最佳劇情"],["最佳畫面","最佳配樂","最佳配音","最治癒","最感動"],["最虐心","最被低估","最過譽","最離譜","最討厭"]],A=["入坑作","最喜歡","看最多次","最想安利","最佳劇情","最佳畫面","最佳配樂","最佳配音","最治癒","最感動","最虐心","最被低估","最過譽","最離譜","最討厭","最暴死","最佳原創","最佳漫改","最佳輕改","最佳劇場版","最荒謬","最後悔看","最冷門神作","最佳OP","最佳ED","最期待續作","最意猶未盡"];function x(t){t.forEach(e=>{const r=document.createElement("option");r.text=e,r.value=e,y.add(r)})}x(A);R(M);
