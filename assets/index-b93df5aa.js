(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))y(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&y(m)}).observe(document,{childList:!0,subtree:!0});function u(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function y(a){if(a.ep)return;a.ep=!0;const i=u(a);fetch(a.href,i)}})();const j="/anime-grid/assets/placeholder-76c5564b.webp",C=[["entry","most_liked","most_rewatched","best_recommendation","best_story"],["best_visuals","best_music","best_voice_acting","most_healing","most_touching"],["most_heart_wrenching","most_underrated","most_overrated","most_ridiculous","most_hated"]],H=["entry","most_liked","most_rewatched","best_recommendation","best_story","best_visuals","best_music","best_voice_acting","most_healing","most_touching","most_heart_wrenching","most_underrated","most_overrated","most_ridiculous","most_hated","most_flop","best_original","best_light_novel_adaptation","best_manga_adaptation","best_movie","most_absurd","most_regretted","most_underrated_gem","best_opening_song","best_ending_song","most_anticipated_sequel","yearn_for_more"],O={table:C,options:H},U=["zh-TW","zh","zh-CN","en","ja"];async function N(){try{let c=navigator.language||navigator.userLanguage;return U.indexOf(c)===-1&&(c="en"),await(await fetch(`./_locale/${c}.json`)).json()}catch(c){console.error(c)}}function W(c){return r=>c[r]||r}N().then(c=>{const r=W(c),u={};u.table=O.table.map(t=>t.map(r)),u.options=O.options.map(r),document.querySelectorAll("[data-i18n]").forEach(t=>{const e=r(t.getAttribute("data-i18n"));t.innerText=e});const a=document.getElementById("my_table"),i=document.getElementById("add_row_form"),m=document.getElementById("columns_input"),$=document.getElementById("reset_button"),v=document.getElementById("edit_form"),g=document.getElementById("search_work_input"),L=document.getElementById("search_result"),I=document.getElementById("img_file_input"),p=document.getElementById("img_container"),l=document.getElementById("img_preview"),b=document.getElementById("description"),F=document.getElementById("cancel"),h=document.querySelector("dialog"),w=document.getElementById("save_button");let f,_;function P({numColumns:t,descriptionList:e}){e?t=e.length:t||(t=a.rows[0].cells.length);const n=a.insertRow(-1);for(let s=0;s<t;s++){const o=n.insertCell(s);o.innerHTML='<div class="cell-wrapper"><img class="cell-img" src="data:," alt="data:," /><div class="cell-description"></div></div>',f=o.querySelector(".cell-img"),_=o.querySelector(".cell-description");let d;e?d=e[s]:d=r("click_to_edit"),T(j,d)}}function T(t,e){f.src=t,f.alt=t,_.innerText=e}h.addEventListener("close",()=>{p.innerHTML=""}),v.addEventListener("submit",function(t){t.preventDefault();let e;l.src==="data:,"?e=j:e=l.src,T(e,b.value),l.src="data:,",l.style.display="none",h.close(),v.reset()}),F.addEventListener("click",function(){h.close()});function k(t){const e=new FileReader;e.addEventListener("load",function(){l.src=e.result,l.style.display="block"}),e.readAsDataURL(t)}I.addEventListener("change",function(){const t=I.files[0];k(t)}),v.addEventListener("paste",function(t){const e=t.clipboardData||window.clipboardData;if(!e)return;const n=[...e.items].find(s=>s.type.includes("image"));(n==null?void 0:n.kind)==="file"&&k(n.getAsFile())}),a.addEventListener("click",function(t){h.showModal();const e=t.target.closest(".cell-wrapper");f=e.querySelector(".cell-img"),_=e.querySelector(".cell-description"),b.value=_.innerText,g.focus(),S()}),$.addEventListener("click",function(){m.disabled=!1,a.innerHTML=""}),i.addEventListener("submit",function(t){t.preventDefault(),m.disabled=!0,P({numColumns:m.value})}),w.addEventListener("click",async function(){w.innerText=r("loading");const t=document.getElementById("table_container_wrapper");try{const e=await html2canvas(t,{useCORS:!0}),n=document.createElement("a");n.download="anime-grid.png",n.href=e.toDataURL(),n.click()}catch(e){console.error(e)}w.innerText=r("save_image")});function q(t,e=300){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>{t.apply(this,s)},e)}}async function B(t){t.key==="Enter"&&t.preventDefault(),S()}const A="https://imageproxy-rvvouazbtq-de.a.run.app/";async function S(){let t=g.value;if(t==="")return;t=await x(t)??t,L.innerHTML=`<div>${r("searching")}</div><div>&nbsp</div>`;const n=await D(t);p.innerHTML="";for(const s of n){const o=document.createElement("img");o.src=s,o.addEventListener("click",function(){l.src=A+o.src,l.style.display="block",p.innerHTML=""}),p.appendChild(o)}L.innerHTML=`<span>${r("cant_find_desired_image?")}</span><a href="https://www.google.com/search?tbm=isch&q=${t}" target="_blank">${r("search_in_google_image")}</a><div>${r("paste_here")}</div>`}g.addEventListener("keydown",q(B)),g.addEventListener("input",q(B));async function x(t){let e=new URL("https://zh.wikipedia.org/w/api.php");e.searchParams.set("action","opensearch"),e.searchParams.set("limit","10"),e.searchParams.set("namespace","0"),e.searchParams.set("redirects","resolve"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("search",t);try{let n=await fetch(e),s=await n.json();if(!s[1][0]||(t=s[1][0],e=new URL("https://zh.wikipedia.org/w/api.php"),e.searchParams.set("action","query"),e.searchParams.set("lllimit","1"),e.searchParams.set("prop","langlinks"),e.searchParams.set("lllang","ja"),e.searchParams.set("format","json"),e.searchParams.set("origin","*"),e.searchParams.set("titles",t),n=await fetch(e),s=await n.json(),Object.values(s.query.pages).length===0))return;const o=Object.values(s.query.pages)[0].langlinks;return o?o[0]["*"].replace(/\s\(.*\)/,""):void 0}catch(n){console.error(n)}}async function D(t){var E,R;const o=await(await fetch("https://graphql.anilist.co",{method:"POST",headers:{"Content-Type":"application/json","Accept-Encoding":"gzip"},body:JSON.stringify({query:`
      query ($page: Int, $perPage: Int, $search: String) {
        Page(page: $page, perPage: $perPage) {
          pageInfo {
            total
            currentPage
            lastPage
            hasNextPage
            perPage
          }
          media(search: $search, sort: FAVOURITES_DESC) {
            title {
              romaji
              english
              native
            }
            coverImage {
              large
            }
          }
        }
      }`,variables:{page:1,perPage:12,search:t}})})).json(),d=(R=(E=o==null?void 0:o.data)==null?void 0:E.Page)==null?void 0:R.media;return Array.isArray(d)&&d.length>0?d.map(z=>z.coverImage.large):[]}function M(t){for(const e of t.table)P({descriptionList:e});t.options.forEach(e=>{const n=document.createElement("option");n.text=e,n.value=e,b.add(n)})}M(u)});
